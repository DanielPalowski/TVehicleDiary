@using VehicleDiary.Core.Entities;
@model IEnumerable<VehicleDiary.Web.ViewModels.DBVehicleViewVM>

<div class="container py-4">
    <!-- Modernized "Add New Vehicle" button -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-grid">
                <a asp-controller="Vehicle" asp-action="Create"
                   class="btn-add-vehicle rounded-4 shadow-lg py-3 px-4 text-decoration-none">
                    <div class="d-flex align-items-center justify-content-center">
                        <div class="btn-icon-container me-3">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="text-center">
                            <div class="fw-bold fs-4">Add New Vehicle</div>
                            <div class="small opacity-75">Click to register a new vehicle to your profile</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        @foreach (var entry in Model)
        {
            Random randomImageGen = new Random();
            int randomImage = randomImageGen.Next(1, 5);
            string imagePath = $"~/images/{randomImage}.jpeg";

            <div class="col" id="vehicle-@entry.Id">
                <div class="vehicle-card-container h-100">
                    <!-- Car Image - Full width without borders -->
                    <div class="vehicle-image-container position-relative">
                        <img src="@Url.Content(imagePath)"
                             alt="@entry.Name @entry.Model"
                             class="img-fluid vehicle-image w-100">

                        <!-- Floating vehicle badge -->
                        <div class="vehicle-badge position-absolute top-0 start-0 m-3">
                            <span class="badge bg-dark bg-opacity-75 rounded-pill px-3 py-2">
                                <i class="fas fa-car me-1"></i>@entry.MadeYear
                            </span>
                        </div>
                    </div>

                    <!-- Card Content -->
                    <div class="vehicle-card-content">
                        <!-- Title -->
                        <div class="vehicle-title text-center mb-3">
                            <h3 class="vehicle-name mb-1 fw-bold">@entry.Name @entry.Model</h3>
                            <div class="vehicle-vin text-muted font-monospace small">@entry.VIN</div>
                        </div>

                        <!-- Vehicle Info Grid -->
                        <div class="vehicle-info-grid mb-4">
                            <div class="info-item">
                                <div class="info-icon">
                                    <i class="fas fa-horse-head"></i>
                                </div>
                                <div class="info-content">
                                    <div class="info-label">Power</div>
                                    <div class="info-value">@entry.Power kW</div>
                                </div>
                            </div>

                            <div class="info-item">
                                <div class="info-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <div class="info-content">
                                    <div class="info-label">License Plate</div>
                                    <div class="info-value">@entry.License_plate</div>
                                </div>
                            </div>

                            @if (!string.IsNullOrEmpty(entry.Insurence))
                            {
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="info-content">
                                        <div class="info-label">Insurance</div>
                                        <div class="info-value badge bg-success rounded-pill">@entry.Insurence</div>
                                    </div>
                                </div>
                            }

                            @if (entry.Bought.HasValue)
                            {
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="info-content">
                                        <div class="info-label">Purchased</div>
                                        <div class="info-value">@entry.Bought.Value.ToString("d MMM yyyy")</div>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Repair Costs - Enhanced Design -->
                        <div class="repair-costs-section mb-4">
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-tools me-2 text-danger"></i>
                                    <span class="fw-semibold">Total Repair Costs</span>
                                </div>
                                <span class="repair-cost-amount fw-bold">
                                    €@entry.RepairCost?.ToString("N2")
                                </span>
                            </div>
                            <div class="progress repair-cost-progress" style="height: 6px;">
                                <div class="progress-bar bg-danger"
                                     style="width: @(Math.Min((entry.RepairCost ?? 0) / 2000 * 100, 100))%">
                                </div>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <small class="text-muted">€0</small>
                                <small class="text-muted">€2000+</small>
                            </div>
                        </div>

                        <!-- Description -->
                        @if (!string.IsNullOrEmpty(entry.Description))
                        {
                            <div class="vehicle-description mb-4">
                                <div class="description-header d-flex align-items-center mb-2">
                                    <i class="fas fa-align-left me-2 text-primary"></i>
                                    <span class="fw-semibold">Notes</span>
                                </div>
                                <p class="description-text mb-0">@entry.Description</p>
                            </div>
                        }

                        <!-- Action Buttons -->
                        <div class="vehicle-actions">
                            <div class="d-grid gap-2">
                                <a asp-controller="Repair" asp-action="Index"
                                   asp-route-vehicleIDRoute="@entry.Id"
                                   class="btn btn-action repair-btn rounded-3 py-2">
                                    <i class="fas fa-tools me-2"></i>Repair History
                                </a>
                                <a asp-controller="CarUsage" asp-action="Index"
                                   asp-route-vehicleIDRoute="@entry.Id"
                                   class="btn btn-action usage-btn rounded-3 py-2">
                                    <i class="fas fa-road me-2"></i>Usage Stats
                                </a>
                                <button onclick="deleteVehicle('@entry.Id')"
                                        class="btn btn-action delete-btn rounded-3 py-2">
                                    <i class="fas fa-trash-alt me-2"></i>Remove Vehicle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        function deleteVehicle(vehicleID) {
            if (confirm("Are you sure you want to delete this vehicle? This action cannot be undone.")) {
                $.ajax({
                    url: "@Url.Action("Delete", "Vehicle")/" + vehicleID,
                    type: "DELETE",
                    success: function (result) {
                        $("#vehicle-" + vehicleID).fadeOut(300, function () {
                            $(this).remove();
                        });
                    },
                    error: function (err) {
                        alert("An error occurred while deleting the vehicle. Please try again.");
                    }
                });
            }
        }
    </script>
}